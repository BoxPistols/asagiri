<!DOCTYPE html>
<html lang="ja" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ダークモード実装ガイド - Asagiri</title>
    <link rel="icon" type="image/svg+xml" href="../../favicon.svg">
    <link rel="stylesheet" href="../../css/main.css">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            background-color: var(--color-bg);
            color: var(--color-text);
        }
        .doc-header {
            background: linear-gradient(135deg, #1a1a2e 0%, #0f3460 100%);
            color: white;
            padding: 3rem 0;
            margin-bottom: 2rem;
        }
        .doc-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem 4rem;
        }
        .doc-section {
            margin-bottom: 3rem;
            padding: 2rem;
            background: var(--color-box);
            border-radius: var(--border-radius);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .doc-section h2 {
            color: var(--color-primary);
            margin-top: 0;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--color-border);
        }
        .code-block {
            background: var(--color-bg);
            border: 1px solid var(--color-border);
            border-radius: var(--border-radius);
            padding: 1rem;
            margin: 1rem 0;
            overflow-x: auto;
        }
        .code-block pre {
            margin: 0;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
        }
        .copy-btn {
            float: right;
            margin-bottom: 0.5rem;
        }
        .demo-box {
            padding: 1.5rem;
            background: var(--color-bg);
            border: 1px solid var(--color-border);
            border-radius: var(--border-radius);
            margin: 1rem 0;
        }
        .step-number {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 2rem;
            height: 2rem;
            background: var(--color-primary);
            color: white;
            border-radius: 50%;
            font-weight: bold;
            margin-right: 0.5rem;
        }
        .info-box {
            padding: 1rem;
            background: var(--color-info-bg, #e7f3ff);
            border-left: 4px solid var(--color-info);
            border-radius: var(--border-radius);
            margin: 1rem 0;
        }
        .success-box {
            padding: 1rem;
            background: var(--color-success-bg, #d4edda);
            border-left: 4px solid var(--color-success);
            border-radius: var(--border-radius);
            margin: 1rem 0;
        }
        .warning-box {
            padding: 1rem;
            background: var(--color-warning-bg, #fff3cd);
            border-left: 4px solid var(--color-warning);
            border-radius: var(--border-radius);
            margin: 1rem 0;
        }
    </style>
</head>
<body>
    <!-- Theme Toggle -->
    <button class="theme-toggle floating-theme-toggle" aria-label="Toggle theme">
        <svg id="theme-icon-moon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
        </svg>
        <svg id="theme-icon-sun" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display:none;">
            <circle cx="12" cy="12" r="5"></circle>
            <line x1="12" y1="1" x2="12" y2="3"></line>
            <line x1="12" y1="21" x2="12" y2="23"></line>
            <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
            <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
            <line x1="1" y1="12" x2="3" y2="12"></line>
            <line x1="21" y1="12" x2="23" y2="12"></line>
            <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
            <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
        </svg>
    </button>

    <!-- Scroll to Top Button -->
    <button class="scroll-top" id="scrollTopBtn" aria-label="Scroll to top">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="19" x2="12" y2="5"></line><polyline points="5 12 12 5 19 12"></polyline></svg>
    </button>

    <div class="doc-header">
        <div class="doc-container">
            <h1>ダークモード実装ガイド</h1>
            <p>Asagiriで簡単にダークモードを実装する完全ガイド</p>
            <a href="../getting-started.html" class="btn btn-outline-light">← ドキュメントに戻る</a>
        </div>
    </div>

    <div class="doc-container">
        <!-- クイックスタート -->
        <section class="doc-section">
            <h2>クイックスタート（3ステップ）</h2>
            <p>以下のコードをコピーするだけで、すぐにダークモードが使えます！</p>

            <h3><span class="step-number">1</span>HTMLにdata-theme属性を追加</h3>
            <div class="code-block">
                <button class="btn btn-sm copy-btn" onclick="copyCode(this)">Copy</button>
                <pre><code>&lt;!DOCTYPE html&gt;
&lt;html lang="ja" data-theme="light"&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;link rel="stylesheet" href="path/to/asagiri.min.css"&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;!-- ここにコンテンツ --&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
            </div>

            <h3><span class="step-number">2</span>テーマ切り替えボタンを追加</h3>
            <div class="code-block">
                <button class="btn btn-sm copy-btn" onclick="copyCode(this)">Copy</button>
                <pre><code>&lt;button class="btn btn-primary" onclick="toggleTheme()"&gt;
    テーマ切替
&lt;/button&gt;</code></pre>
            </div>

            <h3><span class="step-number">3</span>JavaScriptを追加</h3>
            <div class="code-block">
                <button class="btn btn-sm copy-btn" onclick="copyCode(this)">Copy</button>
                <pre><code>&lt;script&gt;
function toggleTheme() {
    const html = document.documentElement;
    const currentTheme = html.getAttribute('data-theme');
    const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
    html.setAttribute('data-theme', newTheme);
    localStorage.setItem('theme', newTheme);
}

// ページ読み込み時にテーマを復元
const savedTheme = localStorage.getItem('theme') || 'light';
document.documentElement.setAttribute('data-theme', savedTheme);
&lt;/script&gt;</code></pre>
            </div>

            <div class="success-box">
                <strong>完了！</strong> これだけでダークモードが動作します。右上のボタンで試してみてください。
            </div>
        </section>

        <!-- 完全なHTMLサンプル -->
        <section class="doc-section">
            <h2>完全なHTMLサンプル</h2>
            <p>このコードをコピーして、新しいHTMLファイルに貼り付けるだけで動作します。</p>

            <div class="code-block">
                <button class="btn btn-sm copy-btn" onclick="copyCode(this)">Copy</button>
                <pre><code>&lt;!DOCTYPE html&gt;
&lt;html lang="ja" data-theme="light"&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;
    &lt;title&gt;ダークモード対応ページ&lt;/title&gt;
    &lt;link rel="stylesheet" href="dist/asagiri.min.css"&gt;
    &lt;style&gt;
        body {
            background-color: var(--color-bg);
            color: var(--color-text);
            min-height: 100vh;
            padding: 2rem;
        }
    &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;div class="container"&gt;
        &lt;header style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;"&gt;
            &lt;h1&gt;マイアプリ&lt;/h1&gt;
            &lt;button class="btn btn-primary" onclick="toggleTheme()"&gt;
                テーマ切替
            &lt;/button&gt;
        &lt;/header&gt;

        &lt;div class="card"&gt;
            &lt;div class="card-header"&gt;
                &lt;h2&gt;ダークモード対応カード&lt;/h2&gt;
            &lt;/div&gt;
            &lt;div class="card-body"&gt;
                &lt;p&gt;このカードは自動的にダークモードに対応します。&lt;/p&gt;
                &lt;button class="btn btn-success"&gt;成功&lt;/button&gt;
                &lt;button class="btn btn-danger"&gt;エラー&lt;/button&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/div&gt;

    &lt;script&gt;
        function toggleTheme() {
            const html = document.documentElement;
            const currentTheme = html.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            html.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
        }

        // ページ読み込み時にテーマを復元
        const savedTheme = localStorage.getItem('theme') || 'light';
        document.documentElement.setAttribute('data-theme', savedTheme);
    &lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
            </div>
        </section>

        <!-- システム設定に従う -->
        <section class="doc-section">
            <h2>システムのダークモード設定に従う</h2>
            <p>ユーザーのOSのダークモード設定を自動的に検出して適用できます。</p>

            <div class="code-block">
                <button class="btn btn-sm copy-btn" onclick="copyCode(this)">Copy</button>
                <pre><code>&lt;script&gt;
// システムのダークモード設定を検出
function getPreferredTheme() {
    // 保存されたテーマを優先
    const savedTheme = localStorage.getItem('theme');
    if (savedTheme) {
        return savedTheme;
    }

    // システム設定を検出
    if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
        return 'dark';
    }

    return 'light';
}

// テーマを適用
const preferredTheme = getPreferredTheme();
document.documentElement.setAttribute('data-theme', preferredTheme);

// システム設定の変更を監視
window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
    // ユーザーが手動で設定していない場合のみ変更
    if (!localStorage.getItem('theme')) {
        const newTheme = e.matches ? 'dark' : 'light';
        document.documentElement.setAttribute('data-theme', newTheme);
    }
});

// テーマ切り替え関数
function toggleTheme() {
    const html = document.documentElement;
    const currentTheme = html.getAttribute('data-theme');
    const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
    html.setAttribute('data-theme', newTheme);
    localStorage.setItem('theme', newTheme);
}
&lt;/script&gt;</code></pre>
            </div>

            <div class="info-box">
                <strong>ポイント：</strong>このコードは、ユーザーが手動で切り替えた場合はその設定を優先し、そうでない場合はシステム設定に従います。
            </div>
        </section>

        <!-- アニメーション付きトグル -->
        <section class="doc-section">
            <h2>アニメーション付きトグルボタン</h2>
            <p>よりリッチなテーマ切り替えボタンの実装例です。</p>

            <div class="demo-box">
                <button class="btn btn-primary" id="fancyToggle" onclick="toggleThemeWithAnimation()">
                    <svg id="themeIconMoon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display:inline;vertical-align:middle;margin-right:4px;"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>
                    <svg id="themeIconSun" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display:none;vertical-align:middle;margin-right:4px;"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>
                    <span id="themeText">ダークモード</span>
                </button>
            </div>

            <div class="code-block">
                <button class="btn btn-sm copy-btn" onclick="copyCode(this)">Copy</button>
                <pre><code>&lt;button class="btn btn-primary" onclick="toggleThemeWithAnimation()"&gt;
    &lt;span id="themeText"&gt;ダークモード&lt;/span&gt;
&lt;/button&gt;

&lt;script&gt;
function toggleThemeWithAnimation() {
    const html = document.documentElement;
    const currentTheme = html.getAttribute('data-theme');
    const newTheme = currentTheme === 'dark' ? 'light' : 'dark';

    // テーマを変更
    html.setAttribute('data-theme', newTheme);
    localStorage.setItem('theme', newTheme);

    // ボタンのテキストを更新
    const text = document.getElementById('themeText');

    if (newTheme === 'dark') {
        text.textContent = 'ライトモード';
    } else {
        text.textContent = 'ダークモード';
    }
}

// 初期化
window.addEventListener('DOMContentLoaded', () => {
    const currentTheme = document.documentElement.getAttribute('data-theme');
    const text = document.getElementById('themeText');

    if (currentTheme === 'dark') {
        text.textContent = 'ライトモード';
    }
});
&lt;/script&gt;</code></pre>
            </div>
        </section>

        <!-- カスタムカラー -->
        <section class="doc-section">
            <h2>ダークモードのカラーをカスタマイズ</h2>
            <p>独自のダークモードカラーを設定したい場合は、以下のようにCSS変数をオーバーライドします。</p>

            <div class="code-block">
                <button class="btn btn-sm copy-btn" onclick="copyCode(this)">Copy</button>
                <pre><code>&lt;style&gt;
/* ダークモード時のカスタムカラー */
[data-theme="dark"] {
    --color-primary: #60a5fa;
    --color-secondary: #a78bfa;
    --color-success: #34d399;
    --color-danger: #f87171;
    --color-warning: #fbbf24;
    --color-info: #38bdf8;

    --color-bg: #0f172a;
    --color-box: #1e293b;
    --color-text: #f1f5f9;
    --color-border: #334155;
}

/* ライトモード時のカスタムカラー（オプション） */
[data-theme="light"] {
    --color-primary: #3b82f6;
    --color-secondary: #8b5cf6;
    --color-bg: #ffffff;
    --color-text: #1f2937;
}
&lt;/style&gt;</code></pre>
            </div>
        </section>

        <!-- トラブルシューティング -->
        <section class="doc-section">
            <h2>トラブルシューティング</h2>

            <h3>Q1: テーマが切り替わらない</h3>
            <div class="warning-box">
                <strong>解決方法：</strong>
                <ol>
                    <li>HTMLタグに <code>data-theme="light"</code> 属性があるか確認</li>
                    <li>JavaScriptが正しく読み込まれているか確認</li>
                    <li>ブラウザのコンソールでエラーがないか確認</li>
                </ol>
            </div>

            <h3>Q2: 一部の要素だけダークモードにならない</h3>
            <div class="warning-box">
                <strong>解決方法：</strong>
                <p>CSS変数を使用していることを確認してください。</p>
                <div class="code-block">
                    <pre><code>/* BAD: ハードコーディングされた色 */
.my-element {
    background: #ffffff;
    color: #000000;
}

/* GOOD: CSS変数を使用 */
.my-element {
    background: var(--color-bg);
    color: var(--color-text);
}</code></pre>
                </div>
            </div>

            <h3>Q3: ページ読み込み時にテーマが一瞬切り替わる（フラッシュ）</h3>
            <div class="warning-box">
                <strong>解決方法：</strong>
                <p>テーマ復元スクリプトを<code>&lt;head&gt;</code>内の最初に配置してください。</p>
                <div class="code-block">
                    <pre><code>&lt;head&gt;
    &lt;script&gt;
        // 最初に実行
        const savedTheme = localStorage.getItem('theme') || 'light';
        document.documentElement.setAttribute('data-theme', savedTheme);
    &lt;/script&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;link rel="stylesheet" href="asagiri.min.css"&gt;
&lt;/head&gt;</code></pre>
                </div>
            </div>
        </section>

        <!-- ベストプラクティス -->
        <section class="doc-section">
            <h2>ベストプラクティス</h2>

            <div class="info-box">
                <h4>推奨事項</h4>
                <ul>
                    <li>常にCSS変数（<code>var(--color-*)</code>）を使用する</li>
                    <li>ユーザーの選択をlocalStorageに保存する</li>
                    <li>システム設定を尊重する</li>
                    <li>アクセシビリティを考慮したコントラスト比を保つ</li>
                    <li>画像にも対応する（ダークモード用の画像を用意）</li>
                </ul>
            </div>

            <div class="warning-box">
                <h4>避けるべきこと</h4>
                <ul>
                    <li>ハードコーディングされた色の使用</li>
                    <li>!importantの過度な使用</li>
                    <li>ユーザーの選択を無視してシステム設定を強制</li>
                    <li>コントラスト比の低い配色</li>
                </ul>
            </div>
        </section>

        <!-- 実践例 -->
        <section class="doc-section">
            <h2>実践例：完全なダークモード対応ページ</h2>
            <p>実際のプロジェクトで使える完全な実装例：</p>

            <div class="code-block">
                <button class="btn btn-sm copy-btn" onclick="copyCode(this)">Copy</button>
                <pre><code>&lt;!DOCTYPE html&gt;
&lt;html lang="ja"&gt;
&lt;head&gt;
    &lt;!-- テーマフラッシュを防ぐため、最初にテーマを復元 --&gt;
    &lt;script&gt;
        (function() {
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme) {
                document.documentElement.setAttribute('data-theme', savedTheme);
            } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
                document.documentElement.setAttribute('data-theme', 'dark');
            } else {
                document.documentElement.setAttribute('data-theme', 'light');
            }
        })();
    &lt;/script&gt;

    &lt;meta charset="UTF-8"&gt;
    &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;
    &lt;title&gt;完全なダークモード対応&lt;/title&gt;
    &lt;link rel="stylesheet" href="dist/asagiri.min.css"&gt;

    &lt;style&gt;
        body {
            background-color: var(--color-bg);
            color: var(--color-text);
            transition: background-color 0.3s ease, color 0.3s ease;
        }
    &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;!-- ここにコンテンツ --&gt;

    &lt;script src="theme.js"&gt;&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
            </div>

            <p><strong>theme.js:</strong></p>
            <div class="code-block">
                <button class="btn btn-sm copy-btn" onclick="copyCode(this)">Copy</button>
                <pre><code>// theme.js - このファイルをコピーして使用できます

class ThemeManager {
    constructor() {
        this.init();
    }

    init() {
        // システム設定の変更を監視
        window.matchMedia('(prefers-color-scheme: dark)')
            .addEventListener('change', (e) => {
                if (!localStorage.getItem('theme')) {
                    this.setTheme(e.matches ? 'dark' : 'light');
                }
            });
    }

    getCurrentTheme() {
        return document.documentElement.getAttribute('data-theme');
    }

    setTheme(theme) {
        document.documentElement.setAttribute('data-theme', theme);
        localStorage.setItem('theme', theme);

        // カスタムイベントを発行
        window.dispatchEvent(new CustomEvent('themechange', {
            detail: { theme }
        }));
    }

    toggleTheme() {
        const currentTheme = this.getCurrentTheme();
        const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
        this.setTheme(newTheme);
        return newTheme;
    }
}

// グローバルインスタンス
const themeManager = new ThemeManager();

// ショートカット関数
function toggleTheme() {
    return themeManager.toggleTheme();
}

// テーマ変更をリッスンする例
window.addEventListener('themechange', (e) => {
    console.log('Theme changed to:', e.detail.theme);
});</code></pre>
            </div>
        </section>
    </div>

    <script>
        function updateThemeIcon(theme) {
            const moon = document.getElementById('theme-icon-moon');
            const sun = document.getElementById('theme-icon-sun');
            if (moon && sun) {
                moon.style.display = theme === 'dark' ? 'none' : 'block';
                sun.style.display = theme === 'dark' ? 'block' : 'none';
            }
        }

        function toggleThemeWithAnimation() {
            const html = document.documentElement;
            const currentTheme = html.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';

            html.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            updateThemeIcon(newTheme);

            const moonIcon = document.getElementById('themeIconMoon');
            const sunIcon = document.getElementById('themeIconSun');
            const text = document.getElementById('themeText');

            if (moonIcon && sunIcon) {
                moonIcon.style.display = newTheme === 'dark' ? 'none' : 'inline';
                sunIcon.style.display = newTheme === 'dark' ? 'inline' : 'none';
            }
            if (text) {
                text.textContent = newTheme === 'dark' ? 'ライトモード' : 'ダークモード';
            }
        }

        function copyCode(button) {
            const codeBlock = button.parentElement.querySelector('code');
            const text = codeBlock.textContent;
            navigator.clipboard.writeText(text).then(() => {
                const originalText = button.textContent;
                button.textContent = 'Copied!';
                setTimeout(() => {
                    button.textContent = originalText;
                }, 2000);
            });
        }

        const savedTheme = localStorage.getItem('theme') || 'light';
        document.documentElement.setAttribute('data-theme', savedTheme);
        updateThemeIcon(savedTheme);

        // 初期化
        window.addEventListener('DOMContentLoaded', () => {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            updateThemeIcon(currentTheme);

            const moonIcon = document.getElementById('themeIconMoon');
            const sunIcon = document.getElementById('themeIconSun');
            const text = document.getElementById('themeText');

            if (moonIcon && sunIcon) {
                moonIcon.style.display = currentTheme === 'dark' ? 'none' : 'inline';
                sunIcon.style.display = currentTheme === 'dark' ? 'inline' : 'none';
            }
            if (text && currentTheme === 'dark') {
                text.textContent = 'ライトモード';
            }
        });
    </script>

    <!-- Shared JavaScript modules -->
    <script src="../../js/theme.js"></script>
    <script src="../../js/scroll-top.js"></script>
</body>
</html>
